workspace:
  base: /go
  path: src/github.com/gooption-io/gooption

pipeline:

  
  docker-compose-copy:
    image: appleboy/drone-scp:latest
    host: gooption.io
    port: 22
    target: /home/gooption
    source: /go/src/github.com/gooption-io/gooption
    secrets: [SSH_USERNAME, SSH_KEY]
    
  
  docker-compose-up:
    image: appleboy/drone-ssh:latest
    host: gooption.io
    script:
      - /usr/local/bin/docker-compose up -f /home/gooption/docker-compose.yml
    secrets: [SSH_USERNAME, SSH_PASSWORD]
    
  build-gobs:
    image: golang:1.10
    commands:
      - cd gobs
      - go get -v
      - go build
      - go test

  docker-gobs:
    image: plugins/docker:latest
    repo: gooption/gobs
    tags:
      - v0
    dockerfile: ./gobs/dockerfile
    context: ./gobs
    secrets: [DOCKER_USERNAME, DOCKER_PASSWORD]
  
  build-goquantlib:
    image: golang:1.10
    commands:
      - apt-get update && apt-get install -y libboost-all-dev libquantlib0-dev swig
      - cd goquantlib
      - go get -v
      - go build
      - go test
      
  docker-goquantlib:
    image: plugins/docker:latest
    repo: gooption/goquantlib
    tags:
      - v0
    dockerfile: ./goquantlib/dockerfile
    context: ./goquantlib
    secrets: [DOCKER_USERNAME, DOCKER_PASSWORD]
